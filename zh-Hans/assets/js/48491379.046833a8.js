"use strict";(globalThis.webpackChunk_ssml_editor_website=globalThis.webpackChunk_ssml_editor_website||[]).push([[1250],{4974(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/toolbar","title":"\u5de5\u5177\u680f","description":"\u6a21\u7ec4\u7684\u914d\u7f6e\u505a\u5230\u4e86\u7f16\u8f91\u5668\u8282\u70b9\u7684\u6570\u636e\u8f6c\u6362\uff0c\u800c\u5de5\u5177\u680f\u7684\u914d\u7f6e\u8ba9\u7528\u6237\u53ef\u4ee5\u63d2\u5165\u6216\u7f16\u8f91\u5bf9\u5e94\u6a21\u7ec4\u7684\u8282\u70b9\uff0c\u4ece\u800c\u505a\u5230\u4ece\u521b\u5efa\u8282\u70b9\u5230SSML\u7ed3\u6784\u751f\u6210\u7684\u5168\u90e8\u6d41\u7a0b\u3002","source":"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/version-1.0.2/guides/toolbar.md","sourceDirName":"guides","slug":"/guides/toolbar","permalink":"/zh-Hans/docs/guides/toolbar","draft":false,"unlisted":false,"editUrl":"https://github.com/ssml-editor/ssml-editor/tree/master/website/versioned_docs/version-1.0.2/guides/toolbar.md","tags":[],"version":"1.0.2","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\u6807\u51c6\u5316SSML","permalink":"/zh-Hans/docs/guides/normalizer"},"next":{"title":"\u5e95\u90e8\u680f","permalink":"/zh-Hans/docs/guides/footer"}}');var s=i(6259),o=i(3230);const r={sidebar_position:5},l="\u5de5\u5177\u680f",a={},d=[{value:"\u521b\u5efa\u83dc\u5355",id:"\u521b\u5efa\u83dc\u5355",level:2},{value:"\u5b9e\u73b0\u64cd\u4f5c\u8282\u70b9\u7684\u529f\u80fd",id:"\u5b9e\u73b0\u64cd\u4f5c\u8282\u70b9\u7684\u529f\u80fd",level:2},{value:"\u4f7f\u7528\u83dc\u5355",id:"\u4f7f\u7528\u83dc\u5355",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u5de5\u5177\u680f",children:"\u5de5\u5177\u680f"})}),"\n",(0,s.jsx)(n.p,{children:"\u6a21\u7ec4\u7684\u914d\u7f6e\u505a\u5230\u4e86\u7f16\u8f91\u5668\u8282\u70b9\u7684\u6570\u636e\u8f6c\u6362\uff0c\u800c\u5de5\u5177\u680f\u7684\u914d\u7f6e\u8ba9\u7528\u6237\u53ef\u4ee5\u63d2\u5165\u6216\u7f16\u8f91\u5bf9\u5e94\u6a21\u7ec4\u7684\u8282\u70b9\uff0c\u4ece\u800c\u505a\u5230\u4ece\u521b\u5efa\u8282\u70b9\u5230SSML\u7ed3\u6784\u751f\u6210\u7684\u5168\u90e8\u6d41\u7a0b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5de5\u5177\u680f\u83dc\u5355\u529f\u80fd\u4e0e\u6a21\u7ec4\u529f\u80fd\u6709\u5173\u8054\uff0c\u4f46\u5de5\u5177\u680f\u83dc\u5355\u914d\u7f6e\u5e76\u6ca1\u6709\u653e\u5728\u6a21\u7ec4\u914d\u7f6e\u5185\uff0c\u539f\u56e0\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6a21\u7ec4\u4e0e\u5de5\u5177\u680f\u83dc\u5355\u5bf9\u5e94\u5173\u7cfb\u6709\u53ef\u80fd\u662f\u4e00\u5bf9\u591a\uff0c\u5373\u4e00\u4e2a\u6a21\u7ec4\u53ef\u80fd\u4f1a\u5bf9\u5e94\u591a\u4e2a\u5de5\u5177\u680f\u83dc\u5355\u529f\u80fd\u3002\u4f8b\u5982\uff1a\u97f3\u6807\u4e0e\u591a\u97f3\u5b57\u4f7f\u7528\u7684\u540c\u4e00\u4e2a\u6a21\u7ec4 ",(0,s.jsx)(n.code,{children:"phoneme"})," \u3002"]}),"\n",(0,s.jsx)(n.li,{children:"\u67d0\u4e9b\u5de5\u5177\u680f\u83dc\u5355\u5e76\u4e0d\u9700\u8981\u6a21\u7ec4\u529f\u80fd\u3002\u4f8b\u5982\uff1a\u64a4\u9500\u3001\u91cd\u505a\u3001\u5168\u5c4f\u3001\u4fdd\u5b58\u7b49\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u521b\u5efa\u83dc\u5355",children:"\u521b\u5efa\u83dc\u5355"}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u5b8c\u6574\u4ee3\u7801\u8bf7\u53c2\u8003 ",(0,s.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/packages/editor-vue/src/cosy-voice/toolbar-menu/alias/alias-menu.vue",children:"\u522b\u540d\u83dc\u5355"})," \u3002"]}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:"\u67e5\u770b\u5b8c\u6574\u793a\u4f8b"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="ssml-editor\\src\\cosy-voice\\toolbar-menu\\alias\\alias-menu.vue"',children:"<template>\n  <popover v-model=\"popoverVisible\" :width=\"200\" @submit=\"submitHandler\">\n    <template #reference>\n      <Button icon-class=\"iconfont-ssml-editor icon-ssml-editor-bieming\" @click=\"menuClickHandler\">\u522b\u540d</Button>\n    </template>\n    <el-form @submit.prevent=\"submitHandler\">\n      <el-input type=\"text\" ref=\"alias-input\" v-model=\"aliasInputValue\"></el-input>\n    </el-form>\n  </popover>\n</template>\n\n<script setup lang=\"ts\">\nimport { Popover } from '@/component';\nimport { SUB_TYPE } from '@/cosy-voice';\nimport {\n  type BaseEditor,\n  type BaseElement,\n  Button,\n  EditorUtils,\n} from '@ssml-editor/vue';\nimport { ElForm, ElInput } from 'element-plus';\nimport { Editor as SlateEditor } from 'slate-vue3/core';\nimport {\n  nextTick,\n  onUnmounted,\n  ref,\n  shallowRef,\n  useTemplateRef,\n  watch,\n} from 'vue';\nimport { AliasMenuService } from './alias-menu-service';\n\nconst props = defineProps<{ editor?: BaseEditor }>();\nconst popoverVisible = ref(false);\nconst aliasInputValue = ref('');\nconst aliasMenuService = shallowRef<AliasMenuService>();\nconst aliasInputRef = useTemplateRef('alias-input');\n\nfunction show(callback?: () => void) {\n  popoverVisible.value = true;\n  callback && nextTick(callback);\n}\n\nfunction hide(callback?: () => void) {\n  popoverVisible.value = false;\n  callback && nextTick(callback);\n}\n\nasync function menuClickHandler() {\n  const editor = props.editor;\n  if (editor) {\n    aliasMenuService.value ??= new AliasMenuService(editor);\n    EditorUtils.trimSelection(editor);\n    if (!aliasMenuService.value.isDisabled()) {\n      const data = aliasMenuService.value.getSerializedNode();\n      if (data) {\n        aliasInputValue.value = data.alias;\n      } else {\n        aliasInputValue.value = '';\n      }\n      show(() => {\n        aliasInputRef.value?.focus();\n      });\n    }\n  }\n}\n\nfunction submitHandler() {\n  const node = aliasMenuService.value?.setNode(aliasInputValue.value);\n  hide(() => {\n    setTimeout(() => {\n      const editor = props.editor;\n      if (node && editor) {\n        const path = EditorUtils.findPath(editor, node);\n        if (path) {\n          const point = SlateEditor.end(editor, path);\n          editor.select(point);\n        }\n      }\n    });\n  });\n}\n\nfunction ssmlMarkClickHandler(\n  _eventName: string,\n  _editor: BaseEditor,\n  elem: BaseElement,\n) {\n  if (elem.type === SUB_TYPE) {\n    aliasMenuService.value = undefined;\n    menuClickHandler();\n  }\n}\n\nwatch(\n  () => props.editor,\n  (newValue, oldValue) => {\n    oldValue?.off('ssml-mark-click', ssmlMarkClickHandler);\n    newValue?.on('ssml-mark-click', ssmlMarkClickHandler);\n  },\n  {\n    immediate: true,\n  },\n);\n\nonUnmounted(() => {\n  props.editor?.off('ssml-mark-click', ssmlMarkClickHandler);\n});\n<\/script>\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"\u5b9e\u73b0\u64cd\u4f5c\u8282\u70b9\u7684\u529f\u80fd",children:"\u5b9e\u73b0\u64cd\u4f5c\u8282\u70b9\u7684\u529f\u80fd"}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u5b8c\u6574\u4ee3\u7801\u8bf7\u53c2\u8003 ",(0,s.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/packages/editor-vue/src/cosy-voice/toolbar-menu/alias/alias-menu-service.ts",children:"\u522b\u540d\u670d\u52a1"})," \u3002"]}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:"\u67e5\u770b\u5b8c\u6574\u793a\u4f8b"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="ssml-editor\\src\\cosy-voice\\toolbar-menu\\alias\\alias-menu-service.ts"',children:"import { SPEAK_TYPE, SUB_TYPE, type Sub } from '@/cosy-voice';\nimport { Warning } from '@ssml-editor/base';\nimport { EditorUtils, MenuBaseService } from '@ssml-editor/vue';\nimport { Range, type Descendant } from 'slate-vue3/core';\n\nexport class AliasMenuService extends MenuBaseService {\n  override isDisabled(): boolean {\n    if (super.isDisabled()) return true;\n    const { selection } = this.editor;\n    if (!selection) return true;\n    if (Range.isCollapsed(selection)) {\n      throw new Warning('\u8bf7\u6846\u9009\u8981\u8bbe\u7f6e\u522b\u540d\u7684\u6587\u672c');\n    }\n    const speakNode = EditorUtils.findSelectedNodeByType(\n      this.editor,\n      SPEAK_TYPE,\n    );\n    if (!speakNode) {\n      throw new Warning('\u53ea\u80fd\u4e3a\u5df2\u8bbe\u7f6e\u4e86\u5c5e\u6027\u7684\u6bb5\u843d\u4e2d\u7684\u6587\u672c\u8bbe\u7f6e\u522b\u540d');\n    }\n    return false;\n  }\n\n  getSerializedNode(): Sub | undefined {\n    const node = EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n    if (node) {\n      return node as Sub;\n    }\n  }\n\n  setNode(alias: string): Descendant | null {\n    if (!this.isDisabled()) {\n      const value = this.getText();\n      if (value) {\n        const element: Sub = {\n          type: SUB_TYPE,\n          mark: alias,\n          alias: alias,\n          children: [{ text: value }],\n        };\n        const node = EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n        if (node) {\n          const partialElement = element as Partial<Sub>;\n          delete partialElement.children;\n          delete partialElement.type;\n          EditorUtils.replaceNode(this.editor, node, partialElement);\n          return node;\n        } else {\n          this.editor.insertNode(element);\n          return EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n        }\n      }\n    }\n    return null;\n  }\n}\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528\u83dc\u5355",children:"\u4f7f\u7528\u83dc\u5355"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,s.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/example/src/config.ts",children:"\u914d\u7f6e"})," \u5bf9\u8c61\u7684 ",(0,s.jsx)(n.code,{children:"toolbar"})," \u5c5e\u6027\u4f20\u5165\u83dc\u5355\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="example\\src\\config.ts"',children:"import {\n  AliasMenu,\n  RowContainerAlign,\n  type EditorConfig,\n} from '@ssml-editor/editor-vue';\n\nexport default <EditorConfig>{\n  ...\n  toolbar: {\n    menus: [\n      ...\n      {\n        component: AliasMenu,\n      },\n      ...\n    ],\n    align: RowContainerAlign.CENTER,\n  },\n  ...\n};\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);