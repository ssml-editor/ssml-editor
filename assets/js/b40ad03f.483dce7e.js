"use strict";(globalThis.webpackChunk_ssml_editor_website=globalThis.webpackChunk_ssml_editor_website||[]).push([[3171],{5037(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/toolbar","title":"Toolbar","description":"The module configuration handles data transformation for editor nodes, while the toolbar configuration enables users to insert or edit nodes corresponding to that module\u2014thus covering the entire workflow from node creation to SSML structure generation.","source":"@site/versioned_docs/version-1.0.2/guides/toolbar.md","sourceDirName":"guides","slug":"/guides/toolbar","permalink":"/docs/guides/toolbar","draft":false,"unlisted":false,"editUrl":"https://github.com/ssml-editor/ssml-editor/tree/master/website/versioned_docs/version-1.0.2/guides/toolbar.md","tags":[],"version":"1.0.2","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Normalize SSML","permalink":"/docs/guides/normalizer"},"next":{"title":"Footer","permalink":"/docs/guides/footer"}}');var o=t(6259),s=t(3230);const r={sidebar_position:5},l="Toolbar",a={},d=[{value:"Create Menu",id:"create-menu",level:2},{value:"Implement functionality for manipulating nodes",id:"implement-functionality-for-manipulating-nodes",level:2},{value:"Use Menus",id:"use-menus",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"toolbar",children:"Toolbar"})}),"\n",(0,o.jsx)(n.p,{children:"The module configuration handles data transformation for editor nodes, while the toolbar configuration enables users to insert or edit nodes corresponding to that module\u2014thus covering the entire workflow from node creation to SSML structure generation."}),"\n",(0,o.jsx)(n.p,{children:"Toolbar menu functionality is related to module functionality, but toolbar menu configuration is not included within the module configuration for the following reasons:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The relationship between modules and toolbar menus can be one-to-many; that is, a single module may correspond to multiple toolbar menu items. For example, both phonetic transcription and polyphonic characters use the same ",(0,o.jsx)(n.code,{children:"phoneme"})," module."]}),"\n",(0,o.jsx)(n.li,{children:"Some toolbar menu items do not require any module functionality. Examples include undo, redo, fullscreen, and save."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"create-menu",children:"Create Menu"}),"\n",(0,o.jsxs)(n.p,{children:["For a complete code example, please refer to the ",(0,o.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/packages/editor-vue/src/cosy-voice/toolbar-menu/alias/alias-menu.vue",children:"Alias Menu"})," ."]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"View the full example"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="ssml-editor\\src\\cosy-voice\\toolbar-menu\\alias\\alias-menu.vue"',children:"<template>\n  <popover v-model=\"popoverVisible\" :width=\"200\" @submit=\"submitHandler\">\n    <template #reference>\n      <Button icon-class=\"iconfont-ssml-editor icon-ssml-editor-bieming\" @click=\"menuClickHandler\">\u522b\u540d</Button>\n    </template>\n    <el-form @submit.prevent=\"submitHandler\">\n      <el-input type=\"text\" ref=\"alias-input\" v-model=\"aliasInputValue\"></el-input>\n    </el-form>\n  </popover>\n</template>\n\n<script setup lang=\"ts\">\nimport { Popover } from '@/component';\nimport { SUB_TYPE } from '@/cosy-voice';\nimport {\n  type BaseEditor,\n  type BaseElement,\n  Button,\n  EditorUtils,\n} from '@ssml-editor/vue';\nimport { ElForm, ElInput } from 'element-plus';\nimport { Editor as SlateEditor } from 'slate-vue3/core';\nimport {\n  nextTick,\n  onUnmounted,\n  ref,\n  shallowRef,\n  useTemplateRef,\n  watch,\n} from 'vue';\nimport { AliasMenuService } from './alias-menu-service';\n\nconst props = defineProps<{ editor?: BaseEditor }>();\nconst popoverVisible = ref(false);\nconst aliasInputValue = ref('');\nconst aliasMenuService = shallowRef<AliasMenuService>();\nconst aliasInputRef = useTemplateRef('alias-input');\n\nfunction show(callback?: () => void) {\n  popoverVisible.value = true;\n  callback && nextTick(callback);\n}\n\nfunction hide(callback?: () => void) {\n  popoverVisible.value = false;\n  callback && nextTick(callback);\n}\n\nasync function menuClickHandler() {\n  const editor = props.editor;\n  if (editor) {\n    aliasMenuService.value ??= new AliasMenuService(editor);\n    EditorUtils.trimSelection(editor);\n    if (!aliasMenuService.value.isDisabled()) {\n      const data = aliasMenuService.value.getSerializedNode();\n      if (data) {\n        aliasInputValue.value = data.alias;\n      } else {\n        aliasInputValue.value = '';\n      }\n      show(() => {\n        aliasInputRef.value?.focus();\n      });\n    }\n  }\n}\n\nfunction submitHandler() {\n  const node = aliasMenuService.value?.setNode(aliasInputValue.value);\n  hide(() => {\n    setTimeout(() => {\n      const editor = props.editor;\n      if (node && editor) {\n        const path = EditorUtils.findPath(editor, node);\n        if (path) {\n          const point = SlateEditor.end(editor, path);\n          editor.select(point);\n        }\n      }\n    });\n  });\n}\n\nfunction ssmlMarkClickHandler(\n  _eventName: string,\n  _editor: BaseEditor,\n  elem: BaseElement,\n) {\n  if (elem.type === SUB_TYPE) {\n    aliasMenuService.value = undefined;\n    menuClickHandler();\n  }\n}\n\nwatch(\n  () => props.editor,\n  (newValue, oldValue) => {\n    oldValue?.off('ssml-mark-click', ssmlMarkClickHandler);\n    newValue?.on('ssml-mark-click', ssmlMarkClickHandler);\n  },\n  {\n    immediate: true,\n  },\n);\n\nonUnmounted(() => {\n  props.editor?.off('ssml-mark-click', ssmlMarkClickHandler);\n});\n<\/script>\n"})})]}),"\n",(0,o.jsx)(n.h2,{id:"implement-functionality-for-manipulating-nodes",children:"Implement functionality for manipulating nodes"}),"\n",(0,o.jsxs)(n.p,{children:["For a complete code example, please refer to the ",(0,o.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/packages/editor-vue/src/cosy-voice/toolbar-menu/alias/alias-menu-service.ts",children:"Alias Service"})," ."]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"View the full example"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="ssml-editor\\src\\cosy-voice\\toolbar-menu\\alias\\alias-menu-service.ts"',children:"import { SPEAK_TYPE, SUB_TYPE, type Sub } from '@/cosy-voice';\nimport { Warning } from '@ssml-editor/base';\nimport { EditorUtils, MenuBaseService } from '@ssml-editor/vue';\nimport { Range, type Descendant } from 'slate-vue3/core';\n\nexport class AliasMenuService extends MenuBaseService {\n  override isDisabled(): boolean {\n    if (super.isDisabled()) return true;\n    const { selection } = this.editor;\n    if (!selection) return true;\n    if (Range.isCollapsed(selection)) {\n      throw new Warning('\u8bf7\u6846\u9009\u8981\u8bbe\u7f6e\u522b\u540d\u7684\u6587\u672c');\n    }\n    const speakNode = EditorUtils.findSelectedNodeByType(\n      this.editor,\n      SPEAK_TYPE,\n    );\n    if (!speakNode) {\n      throw new Warning('\u53ea\u80fd\u4e3a\u5df2\u8bbe\u7f6e\u4e86\u5c5e\u6027\u7684\u6bb5\u843d\u4e2d\u7684\u6587\u672c\u8bbe\u7f6e\u522b\u540d');\n    }\n    return false;\n  }\n\n  getSerializedNode(): Sub | undefined {\n    const node = EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n    if (node) {\n      return node as Sub;\n    }\n  }\n\n  setNode(alias: string): Descendant | null {\n    if (!this.isDisabled()) {\n      const value = this.getText();\n      if (value) {\n        const element: Sub = {\n          type: SUB_TYPE,\n          mark: alias,\n          alias: alias,\n          children: [{ text: value }],\n        };\n        const node = EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n        if (node) {\n          const partialElement = element as Partial<Sub>;\n          delete partialElement.children;\n          delete partialElement.type;\n          EditorUtils.replaceNode(this.editor, node, partialElement);\n          return node;\n        } else {\n          this.editor.insertNode(element);\n          return EditorUtils.findSelectedNodeByType(this.editor, SUB_TYPE);\n        }\n      }\n    }\n    return null;\n  }\n}\n"})})]}),"\n",(0,o.jsx)(n.h2,{id:"use-menus",children:"Use Menus"}),"\n",(0,o.jsxs)(n.p,{children:["Pass toolbar via the ",(0,o.jsx)(n.code,{children:"toolbar"})," property in the ",(0,o.jsx)(n.a,{href:"https://github.com/ssml-editor/ssml-editor/blob/master/example/src/config.ts",children:"configuration"})," object:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'showLineNumbers title="example\\src\\config.ts"',children:"import {\n  AliasMenu,\n  RowContainerAlign,\n  type EditorConfig,\n} from '@ssml-editor/editor-vue';\n\nexport default <EditorConfig>{\n  ...\n  toolbar: {\n    menus: [\n      ...\n      {\n        component: AliasMenu,\n      },\n      ...\n    ],\n    align: RowContainerAlign.CENTER,\n  },\n  ...\n};\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);